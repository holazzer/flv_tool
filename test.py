from flv_tool import FlvReader
from flv_tool.flv_tags import FlvTag, PrevTagSize


f = open(r'your_video.flv','rb')
reader = FlvReader(f)
flv = reader.read_flv()

print(flv.body[1].py_native_value)

ls = []
for tag in flv.body:
    if isinstance(tag, PrevTagSize): continue
    if tag.tag_type == 18: ls.append('S')
    elif tag.tag_type == 8:
        if tag.audio_tag_header.aac_packet_type == 0: ls.append('-')
        else: ls.append('_')
    elif tag.tag_type == 9:
        if tag.video_tag_header.frame_type == 1: ls.append('K')
        else: ls.append('.')


"SK-K...__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__K_.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._K__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__K_.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._K__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._K_.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._K__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._K_.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__K_._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._K__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__K_.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._K__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__K_.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._K__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__K_.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._K__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._K_.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._K__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._K_.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__K_._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._K__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__K_.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._K__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__K_.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._K__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__K_.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._K__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._K_.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__K_._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._K_.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__K_._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._K__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__K_.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._K__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__K_.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._K__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__K_.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._K__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._K_.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._.__._._.__._.__._.__._._.__._.__._.__._."\
"__._._.__._.__._.__._._.__.________K"


from flv_tool import FlvReader, FlvWriter

r = FlvReader(open(r'C:\Users\what\Desktop\harvester\ciri.flv', 'rb'))
flv = r.read_flv()

flv.body = flv.body[:len(flv.body)//2]

w = FlvWriter(flv)
w.write_flv()

with open(r'c:/users/what/desktop/test-ciri.flv', 'wb') as f:
    f.write(w.f.getvalue())


r = FlvReader(open(r'C:\Users\what\Desktop\harvester\1126960rPXROLJ7f_4000.flv', 'rb'))
flv = r.read_flv()



keys = []
for tag in flv.body:
    if isinstance(tag, PrevTagSize): continue
    if tag.tag_type == 9 and tag.video_tag_header.frame_type == 1:
        keys.append(tag)






"""
{'onMetaData': {'description': 'Bilibili VXCode Swarm Transcoder r0.2.61(gap_fixed:False)',
   'metadatacreator': 'Version 1.9',
   'hasKeyframes': 1,
   'hasVideo': 1,
   'hasAudio': 1,
   'hasMetadata': 1,
   'canSeekToEnd': 1,
   'duration': 194.404,
   'datasize': 22108709.0,
   'videosize': 18833511.0,
   'framerate': 29.985532392509793,
   'videodatarate': 754.9738434280506,
   'videocodecid': 7.0,
   'width': 852.0,
   'height': 480.0,
   'audiosize': 3218422.0,
   'audiodatarate': 125.63848994876648,
   'audiocodecid': 10.0,
   'audiosamplerate': 3.0,
   'audiosamplesize': 1.0,
   'stereo': 1,
   'filesize': 22110111.0,
   'lasttimestamp': 194.227,
   'lastkeyframetimestamp': 194.227,
   'lastkeyframelocation': 22110091.0,
   'keyframes': {'filepositions': [1402.0,
     1488.0,
     577655.0,
     1686564.0,
     2479011.0,
     3133482.0,
     3839602.0,
     4697313.0,
     5649256.0,
     6525589.0,
     7511575.0,
     8013238.0,
     8974678.0,
     9646426.0,
     10635913.0,
     11404471.0,
     12069199.0,
     12478584.0,
     13123217.0,
     13698753.0,
     14582265.0,
     15436207.0,
     16094744.0,
     16697417.0,
     17378465.0,
     17791489.0,
     18195137.0,
     18432562.0,
     18709311.0,
     18981054.0,
     19351859.0,
     19686682.0,
     19962804.0,
     20285054.0,
     20724025.0,
     21205951.0,
     21405140.0,
     21524779.0,
     21738106.0,
     21912683.0,
     22110091.0],
    'times': [0.0,
     0.0,
     5.005,
     10.01,
     15.015,
     20.02,
     25.025,
     30.03,
     35.035,
     40.04,
     45.045,
     50.05,
     55.055,
     60.06,
     65.065,
     70.07,
     75.075,
     80.08,
     85.085,
     90.09,
     95.095,
     100.1,
     105.105,
     110.11,
     115.115,
     120.12,
     125.125,
     130.13,
     135.135,
     140.14,
     145.145,
     150.15,
     155.155,
     160.16,
     165.165,
     170.17,
     175.175,
     180.18,
     185.185,
     190.19,
     194.227]}}},
 'real_timestamp': 0}
"""


from flv_tool import FlvReader, FlvWriter

r = FlvReader(open(r'd:/99999/99999-1611674231.flv', 'rb'))
flv = r.read_flv()
flv.fix_stream_flv()

w = FlvWriter(flv)
w.write_flv()


with open('f:/99999-test.flv', 'wb') as ff:
    ff.write(w.f.getvalue())




